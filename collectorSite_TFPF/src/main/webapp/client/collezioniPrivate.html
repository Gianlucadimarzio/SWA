<!DOCTYPE html>
<html>
    <head>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">       
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    </head>
    <body>
        
        <style>
            #collezioni{}
            .collezione{ margin-top: 20px; border: 3px solid red; }     
            .disco{ margin-top: 10px; border: 3px solid orange; }
            .traccia{ margin-top: 10px; border: 3px solid yellow; }
            .hidden{ display: none; }
            a{ cursor: pointer; color: black; text-decoration: none; }
            a:hover{ font-weight: bold; color: black; }
        </style>
        <div class="container text-center w-50" >
            <div id="collezioni"></div>
            <button id="btnLogout" class="mt-5" >LOGOUT</button>
        </div>

     

    </body>
</html>
	
<script>

    $(document).ready(function(){
        
        $.ajax({
            type: 'GET',
            url: 'http://localhost:8080/collectorSite_TFPF/rest/v1/collezioni/privata',
            success: function( response ){
                response.forEach( function ( element, i ){
                    var div = `<div class="collezione"><a class="urlCollezione">${element.url}</a></div>`;
                    $( "#collezioni" ).append(div);
                });               
                $( '.collezione' ).each( function(){
                    var collezione = this;
                    $( collezione ).children('.urlCollezione').off().on( "click", function(){
                        $( this ).parent().children( '.infoCollezione' ).toggleClass( 'hidden' );
                        $( this ).parent().children( '.disco' ).toggleClass( 'hidden' );
                    });
                    $.ajax({
                        type: 'GET',
                        url: $( collezione ).children('.urlCollezione').text(),
                        success: function( response ){
                            var div = `<div class="infoCollezione hidden" ><b>${response[0].titolo}</b></div>`;
                            $( collezione ).append( div );
                            response[0].dischi.forEach( function( d ){
                                var div = `<div class="disco hidden"><a class="urlDisco">${d}</a></div>`;
                                $( collezione ).append( div );
                            });

                            $( collezione ).children( '.disco' ).each( function(){
                                var disco = this;
                                $(disco).children('.urlDisco').off().on( "click", function(){                              
                                    $( this ).parent().children( '.infoDisco' ).toggleClass( 'hidden' );
                                    $( this ).parent().children( '.traccia' ).toggleClass( 'hidden' );
                                });
                                $.ajax({
                                    type: 'GET',
                                    url: $(disco).children('.urlDisco').text(),
                                    success: function( response ){
                                        var divTitolo = `<div class="infoDisco hidden" ><b>${response[0].titolo}</b></div>`;
                                        var divAutore = `<div class="infoDisco hidden" ><b>${response[0].autore}</b></div>`;
                                        $( disco ).append( divTitolo );
                                        $( disco ).append( divAutore );
                                        response[0].tracce.forEach( function( t ){
                                            var div = `<div class="traccia hidden" ><a class="urlTraccia" >${t}</a></div>`;
                                            $( disco ).append( div );
                                        });
                                        $( disco ).children( '.traccia' ).each( function(){
                                            var traccia = this;
                                            $(traccia).children('.urlTraccia').off().on( "click", function(){                              
                                                $( this ).parent().children( '.infoTraccia' ).toggleClass( 'hidden' );
                                            });
                                            $.ajax({
                                                type: 'GET',
                                                url:  $(traccia).children('.urlTraccia').text(),
                                                success: function( response ){
                                                    var divTitolo = `<div class="infoTraccia hidden" ><b>${response.titolo}</b></div>`;
                                                    var divDurata = `<div class="infoTraccia hidden" ><b>${response.durata}</b></div>`;
                                                    $( traccia ).append( divTitolo );
                                                    $( traccia ).append( divDurata );
                                                }
                                            });   
                                        });
                                    }
                                });
                            });
                        
                        
                        }
                    });

                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                });   
            },
            error: function(){
                window.location.assign('login.html');
            }
        });
        
        $( "#btnLogout" ).click( function(){
            $.ajax({ 
                type: 'DELETE',
                url: 'http://localhost:8080/collectorSite_TFPF/rest/v1/logout',
                success: function(){                
                    window.location.assign('login.html');
                }
            });           
        });
        
        
        
       
 
    
    
    

        


    });

</script>
	
	
	
	
	
	
	
	
	
</html>

